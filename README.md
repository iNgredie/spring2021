# API для приложения подачи данных домовладельцев
[Приложение подачи данных домовладельцев. Проект](https://docs.google.com/document/d/1u-DE_HC0Gx2DNU-sicepd36jyuZfp9UuEVZ5csqLNhQ/)

## Установка и запуск (пока тестовый)
Установка зависимостей, переводы, миграции БД
```bash
pip install -r requirements.txt
python manage.py compilemessages
python manage.py migrate
```
Для удобства разработки можно внести начальные данные в БД из фикстур
```bash
python manage.py loaddata fixtures.json
```
Запуск сервера разработки
```bash
python manage.py runserver
```

## Настройка сервиса рассылки смс [smsc.ru](https://smsc.ru/)
**На текущий момент мы не можем отправлять смс на номера МЕГАФОН.** Требуется заполнение гарантийных писем. Должна работать отправка на Билайн, МТС, Теле2.

На вкладке "Настройки" во вкладке "API / SMPP" есть чекбокс "Режим тестирования (виртуальная отправка без оплаты)".
- Если чекбокс отмечен галкой, сообщение с кодом будет отображаться в личном кабинете smsc.ru на вкладке "История".
- Если чекбокс не отмечен галкой, сообщение с кодом должно прийти на номер телефона, указанный при входе.


## Авторизация и дальнейшие взаимодействия
Для регистрации пользователя делаем POST запрос на `http://127.0.0.1:8000/api/v1/auth/mobile/` с параметрами
```json
{
  "mobile": "+79876543210"
}
```
Получаем YOURCODE согласно настройкам сервиса рассылки смс.

Далее получаем JWT токен с помощью POST запроса на `http://127.0.0.1:8000/api/v1/auth/customtoken/` c указанным до этого `mobile` и полученным кодом YOURCODE. `agree` - согласие с лицензионным соглашением.
```json
{
  "mobile": "+79876543210",
  "token": "YOURCODE",
  "agree": true
}
```
В ответ получим JWT токен, необходимый для дальнейшего взаимодействия с приложением.
```json
{
  "access": "YOURJWTTOKEN"
}
```
Описание API доступно по адресу `http://127.0.0.1:8000/api/schema/swagger-ui/`

## Группы, пользователи, права
На текущий момент реализованы 2 группы "Жильцы" и "Сотрудники ТСЖ". По умолчанию после вышеуказанных действий пользователь будет добавлен в группу "Жильцы".

## TODO
- Дописать что сделано.
- Дописать что планирем сделать.
- Сделать наглядную таблицу с правами.